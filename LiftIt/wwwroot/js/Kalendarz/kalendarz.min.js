function CalendarApp(n){n instanceof Date||(n=new Date);this.days=["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"];this.months=["Styczeń","Luty","Marzec","Kwiecień","Maj","Czerwiec","Lipiec","Sierpień","Wrzesień","Październik","Listopad","Grudzień"];this.apts=[{name:"Finish this web app",endTime:new Date(2016,4,30,23),startTime:new Date(2016,4,30,21),day:new Date(2016,4,30).toString()},{name:"My Birthday!",endTime:new Date(2016,4,1,23,59),startTime:new Date(2016,4,1,0),day:new Date(2016,4,1).toString()},];this.aptDates=[new Date(2016,4,30).toString(),new Date(2016,4,1).toString()];this.eles={};this.calDaySelected=null;this.calendar=document.getElementById("calendar-app");this.calendarView=document.getElementById("dates");this.calendarMonthDiv=document.getElementById("calendar-month");this.calendarMonthLastDiv=document.getElementById("calendar-month-last");this.calendarMonthNextDiv=document.getElementById("calendar-month-next");this.dayInspirationalQuote=document.getElementById("inspirational-quote");this.todayIsSpan=document.getElementById("footer-date");this.dayViewEle=document.getElementById("day-view");this.dayViewExitEle=document.getElementById("day-view-exit");this.dayViewDateEle=document.getElementById("day-view-date");this.addDayEventEle=document.getElementById("add-event");this.dayEventsEle=document.getElementById("day-events");this.dayEventAddForm={cancelBtn:document.getElementById("add-event-cancel"),addBtn:document.getElementById("add-event-save"),nameEvent:document.getElementById("input-add-event-name"),startTime:document.getElementById("input-add-event-start-time"),endTime:document.getElementById("input-add-event-end-time"),startAMPM:document.getElementById("input-add-event-start-ampm"),endAMPM:document.getElementById("input-add-event-end-ampm")};this.dayEventsList=document.getElementById("day-events-list");this.dayEventBoxEle=document.getElementById("add-day-event-box");this.showView(n);this.addEventListeners();this.todayIsSpan.textContent="Dzisiaj jest: "+this.days[n.getDay()]+", "+n.getDate()+" "+this.months[n.getMonth()]}var timeOut,activeEle,calendar;CalendarApp.prototype.addEventListeners=function(){this.calendar.addEventListener("click",this.mainCalendarClickClose.bind(this));this.todayIsSpan.addEventListener("click",this.showView.bind(this));this.calendarMonthLastDiv.addEventListener("click",this.showNewMonth.bind(this));this.calendarMonthNextDiv.addEventListener("click",this.showNewMonth.bind(this));this.dayViewExitEle.addEventListener("click",this.closeDayWindow.bind(this));this.dayViewDateEle.addEventListener("click",this.showNewMonth.bind(this));this.addDayEventEle.addEventListener("click",this.addNewEventBox.bind(this));this.dayEventAddForm.cancelBtn.addEventListener("click",this.closeNewEventBox.bind(this));this.dayEventAddForm.cancelBtn.addEventListener("keyup",this.closeNewEventBox.bind(this));this.dayEventAddForm.startTime.addEventListener("keyup",this.inputChangeLimiter.bind(this));this.dayEventAddForm.startAMPM.addEventListener("keyup",this.inputChangeLimiter.bind(this));this.dayEventAddForm.endTime.addEventListener("keyup",this.inputChangeLimiter.bind(this));this.dayEventAddForm.endAMPM.addEventListener("keyup",this.inputChangeLimiter.bind(this));this.dayEventAddForm.addBtn.addEventListener("click",this.saveAddNewEvent.bind(this))};CalendarApp.prototype.showView=function(n){var o,s,u,h,t,a;n&&n instanceof Date||(n=new Date);var i=new Date(n),r=i.getFullYear(),f=i.getMonth(),e=new Date,v=new Date(r,f+1,0).getDate(),y=new Date(r,f,1).getDay(),c=new Date(r,i.getMonth()-1,1),l=new Date(r,i.getMonth()+1,1);for(this.calendarMonthDiv.classList.remove("cview__month-activate"),this.calendarMonthDiv.classList.add("cview__month-reset");this.calendarView.firstChild;)this.calendarView.removeChild(this.calendarView.firstChild);for(o=0;o<y;o++)s=document.createElement("div"),s.className="cview--spacer",this.calendarView.appendChild(s);for(u=1;u<=v;u++)h=new Date(r,f,u),t=document.createElement("div"),t.className="cview--date",t.textContent=u,t.setAttribute("data-date",h),t.onclick=this.showDay.bind(this),u==e.getDate()&&r==e.getFullYear()&&f==e.getMonth()&&t.classList.add("today"),this.aptDates.indexOf(h.toString())!==-1&&t.classList.add("has-events"),this.calendarView.appendChild(t);a=this;setTimeout(function(){a.calendarMonthDiv.classList.add("cview__month-activate")},50);this.calendarMonthDiv.textContent=this.months[i.getMonth()]+" "+i.getFullYear();this.calendarMonthDiv.setAttribute("data-date",i);this.calendarMonthLastDiv.textContent="← "+this.months[c.getMonth()];this.calendarMonthLastDiv.setAttribute("data-date",c);this.calendarMonthNextDiv.textContent=this.months[l.getMonth()]+" →";this.calendarMonthNextDiv.setAttribute("data-date",l)};CalendarApp.prototype.showDay=function(n,t){n.stopPropagation();t||(t=n.currentTarget);var i=new Date(t.getAttribute("data-date"));this.calDaySelected=t;this.openDayWindow(i)};CalendarApp.prototype.openDayWindow=function(n){var u=new Date,t=new Date(n),i,r,f;for(this.dayViewDateEle.textContent=this.days[t.getDay()]+", "+this.months[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear(),this.dayViewDateEle.setAttribute("data-date",t),this.dayViewEle.classList.add("calendar--day-view-active"),i="",t<new Date(u.getFullYear(),u.getMonth(),u.getDate())?(i="had ",this.addDayEventEle.style.display="none"):(i="have ",this.addDayEventEle.style.display="inline"),this.addDayEventEle.setAttribute("data-date",t),r=this.showEventsByDay(t),r?(i+=r.length+" ",this.dayInspirationalQuote.textContent=null):(i+="no ",f=Math.round(Math.random()*(this.quotes.length-1)+0),this.dayInspirationalQuote.textContent=this.quotes[f]);this.dayEventsList.firstChild;)this.dayEventsList.removeChild(this.dayEventsList.firstChild);this.dayEventsList.appendChild(this.showEventsCreateElesView(r));this.dayEventsEle.textContent=i+"events on "+this.months[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear()};CalendarApp.prototype.showEventsCreateElesView=function(n){var t=document.createElement("ul"),i;return t.className="day-event-list-ul",n=this.sortEventsByTime(n),i=this,n.forEach(function(n){var s=new Date(n.startTime),e=new Date(n.endTime),c=n.index,o=document.createElement("li"),f,u,r,h;o.className="event-dates";f="<span class='start-time'>"+s.toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"})+"<\/span> <small>through<\/small> ";f+="<span class='end-time'>"+e.toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"})+(e.getDate()!=s.getDate()?" <small>on "+e.toLocaleDateString()+"<\/small>":"")+"<\/span>";f+="<span class='event-name'>"+n.name+"<\/span>";u=document.createElement("div");u.className="event-dates";u.innerHTML=f;r=document.createElement("span");h=document.createTextNode("delete");r.className="event-delete";r.setAttribute("data-idx",c);r.appendChild(h);r.onclick=i.deleteEvent.bind(i);u.appendChild(r);o.appendChild(u);t.appendChild(o)}),t};CalendarApp.prototype.deleteEvent=function(n){var u=this.apts.splice(n.currentTarget.getAttribute("data-idx"),1),t=new Date(u[0].day),f=this.showEventsByDay(t),i,r;f===!1&&(i=this.aptDates.indexOf(t.toString()),i>=0&&(this.aptDates.splice(i,1),r=document.querySelector('.cview--date[data-date="'+t.toString()+'"]'),r&&r.classList.remove("has-events")));this.openDayWindow(t)};CalendarApp.prototype.sortEventsByTime=function(n){return n?n.sort(function(n,t){return new Date(n.startTime)<new Date(t.startTime)?-1:new Date(n.startTime)>new Date(t.startTime)?1:0}):[]};CalendarApp.prototype.showEventsByDay=function(n){var t=[];return this.apts.forEach(function(i,r){n.toString()==i.day.toString()&&(i.index=r,t.push(i))}),t.length?t:!1};CalendarApp.prototype.closeDayWindow=function(){this.dayViewEle.classList.remove("calendar--day-view-active");this.closeNewEventBox()};CalendarApp.prototype.mainCalendarClickClose=function(n){n.currentTarget==n.target&&(this.dayViewEle.classList.remove("calendar--day-view-active"),this.closeNewEventBox())};CalendarApp.prototype.addNewEventBox=function(n){var t=n.currentTarget;this.dayEventBoxEle.setAttribute("data-active","true");this.dayEventBoxEle.setAttribute("data-date",t.getAttribute("data-date"))};CalendarApp.prototype.closeNewEventBox=function(n){if(n&&n.keyCode&&n.keyCode!=13)return!1;this.dayEventBoxEle.setAttribute("data-active","false");this.resetAddEventBox()};CalendarApp.prototype.saveAddNewEvent=function(){var n=this.validateAddEventInput();n||this.addEvent()};CalendarApp.prototype.addEvent=function(){var r=this.dayEventAddForm.nameEvent.value.trim(),t=this.dayEventBoxEle.getAttribute("data-date"),n=new Date(t),i=this.cleanEventTimeStampDates();this.apts.push({name:r,day:n,startTime:i[0],endTime:i[1]});this.closeNewEventBox();this.openDayWindow(t);this.calDaySelected.classList.add("has-events");this.aptDates.indexOf(n.toString())===-1&&this.aptDates.push(n.toString())};CalendarApp.prototype.convertTo23HourTime=function(n,t){var r=n.split(":"),i=n.trim();return r[1]&&r[1].trim()?(i=parseInt(r[0].trim()),r=parseInt(r[1].trim())):(i=parseInt(i),r=0),i=t=="am"?i==12?0:i:i<=11?parseInt(i)+12:i,[i,r]};CalendarApp.prototype.cleanEventTimeStampDates=function(){var s=this.dayEventAddForm.startTime.value.trim()||this.dayEventAddForm.startTime.getAttribute("placeholder")||"8",i=this.dayEventAddForm.startAMPM.value.trim()||this.dayEventAddForm.startAMPM.getAttribute("placeholder")||"am",u,n;i=i=="a"?i+"m":i;u=this.dayEventAddForm.endTime.value.trim()||this.dayEventAddForm.endTime.getAttribute("placeholder")||"9";n=this.dayEventAddForm.endAMPM.value.trim()||this.dayEventAddForm.endAMPM.getAttribute("placeholder")||"pm";n=n=="p"?n+"m":n;var h=this.dayEventBoxEle.getAttribute("data-date"),f=this.convertTo23HourTime(s,i),e=this.convertTo23HourTime(u,n),t=new Date(h),o=new Date(t.getFullYear(),t.getMonth(),t.getDate(),f[0],f[1]),r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),e[0],e[1]);return o>r&&r.setDate(r.getDate()+1),[o,r]};CalendarApp.prototype.validateAddEventInput=function(){var n=!1,t=this.dayEventAddForm.nameEvent.value.trim(),i=this.dayEventAddForm.startTime.value.trim(),r=this.dayEventAddForm.startAMPM.value.trim(),u=this.dayEventAddForm.endTime.value.trim(),f=this.dayEventAddForm.endAMPM.value.trim();return t&&t!=null?this.dayEventAddForm.nameEvent.classList.remove("add-event-edit--error"):(n=!0,this.dayEventAddForm.nameEvent.classList.add("add-event-edit--error"),this.dayEventAddForm.nameEvent.focus()),n};timeOut=null;activeEle=null;CalendarApp.prototype.inputChangeLimiter=function(n){n.currentTarget&&(n=n.currentTarget);timeOut&&n==activeEle&&clearTimeout(timeOut);var t=CalendarApp.prototype.textOptionLimiter,i=n.getAttribute("data-options").split(","),r=n.getAttribute("data-format")||"text";timeOut=setTimeout(function(){n.value=t(i,n.value,r)},600);activeEle=n};CalendarApp.prototype.textOptionLimiter=function(n,t,i){var r,e,o,f,u;return t?t.indexOf(":")!==-1&&i=="datetime"?(r=t.split(":",2),r.length==2&&!r[1].trim())?t:(e=parseInt(r[1]),n.indexOf(r[0])===-1)?n[0]:r[1]=="0"?t:r[1]=="00"?r[0]+":00":e<10?r[0]+":0"+e:!Number.isInteger(e)||e<0||e>59?r[0]:r[0]+":"+e:t.toString().length>=3?(o=(t.toString().length-4)*-1,o==1?(f=t[0],u=t[1]+t[2]):(f=t[0]+t[1],u=t[2]+t[3]),f=Math.max(1,Math.min(12,f)),u=Math.min(59,u),u<10&&(u="0"+u),u=isNaN(u)?"00":u,f=isNaN(f)?"9":f,f+":"+u):n.indexOf(t)===-1?n[0]:t:""};CalendarApp.prototype.resetAddEventBox=function(){this.dayEventAddForm.nameEvent.value="";this.dayEventAddForm.nameEvent.classList.remove("add-event-edit--error");this.dayEventAddForm.endTime.value="";this.dayEventAddForm.startTime.value="";this.dayEventAddForm.endAMPM.value="";this.dayEventAddForm.startAMPM.value=""};CalendarApp.prototype.showNewMonth=function(n){var t=n.currentTarget.dataset.date,i=new Date(t);return this.showView(i),this.closeDayWindow(),!0};calendar=new CalendarApp;console.log(calendar);